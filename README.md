# Devops



## Упрощенная система бэкапов 
Сами бэкапы делаются в панели управления
А этот репозиторий отвечает за синхронизацию бэкапов с я.диском

### Автоматическое удаление БД бэкапов старше 5 дней
```shell
find /www/backup/database -type f -mtime +5 -exec rm {} \; 
```

### Нужна библиотека для python
```shell
python3 -m pip install yadisk
```

### Принцип работы   
Ставим на крон очистку старых файлов.  
Ставим на крон синхронизация папки бэкап БД 
```shell
python3 /var/www/html/devops/ya_disk_sync.py 
```
А если нужно восстановить какой либо файл с бэкапа старый предварительно скачав его с я.диска 
#### Просмотр файлов на я.диске в папке /backup
```shell
python3 /var/www/html/devops/ya_disk_command.py --list
```
#### Скачать файл на сервер
```shell
python3 /var/www/html/devops/ya_disk_command.py --download /backup/example.zip
```

Дальше восстановить этот файл средствами панель управления сервера.  
Скрипты пока заточены только на работу с БД.


### Мониторинг системы
Ставим на крон скрипт который уведомляет о заканчивающимся жестком диске и об оперативной памяти
```shell
python3 /var/www/html/devops/check_memory.py
```